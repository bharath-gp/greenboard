/*! greenboard 2021-02-05 */
"usev strict";function getPercOfVal(a,b){if(!a)return 0;var c=a.passed+a.failed;return 0==c?0:Math.floor(100*(b/c).toFixed(2))}function getPercOfValStr(a,b){return wrapPercStr(getPercOfVal(a,b))}function getItemPerc(a){if(!a)return 0;var b=a.passed+a.failed,c=b+a.pending;return 0==c?0:Math.floor(100*(b/c).toFixed(2))}function getItemPercStr(a){if(getItemPerc(a)>=0)return wrapPercStr(getItemPerc(a))}function wrapPercStr(a){return a+"%"}function msToTime(a){var b=(parseInt(a%1e3/100),parseInt(a/1e3%60)),c=parseInt(a/6e4%60),d=parseInt(a/36e5%24);return d=d<10?"0"+d:d,c=c<10?"0"+c:c,b=b<10?"0"+b:b,d+":"+c+":"+b}var app=angular.module("greenBoard",["ngSanitize","ngAnimate","ui.router","svc.data","svc.query","svc.timeline","app.main","app.target","app.sidebar","app.infobar","app.compare"]);app.run(["$location","$rootScope","Data",function(a,b,c){function d(){var b=a.search();c.setUrlParams(b)}d(),b.$on("$stateChangeStart",function(a,b,c,e,f){d()})}]),app.config(["$stateProvider","$urlRouterProvider",function(a,b){b.otherwise("/server/7.0.0/latest"),a.state("target",{url:"/:target",abstract:!0,template:"<ui-view/>",resolve:{target:["$stateParams",function(a){return a.target}],targetVersions:["$stateParams","Data","QueryService",function(a,b,c){var d=a.target,e=b.getTargetVersions(d);return e||(e=c.getVersions(d)),e}]}}).state("target.version",{url:"/:version",templateUrl:"view.html",controller:"NavCtrl",resolve:{version:["$stateParams","$state","$location","targetVersions","target",function(a,b,c,d,e){var f=a.version||"latest";return"latest"!=f&&-1!=d.indexOf(f)||(f=d[d.length-1]),a.version=f,f}],testsFilter:["$stateParams","$state","Data",function(a,b,c){return a.testsFilter=c.getBuildFilter(),a.testsFilter}],buildsFilter:["$stateParams","$state","Data",function(a,b,c){return a.buildsFilter=c.getBuildsFilter(),a.buildsFilter}]}}).state("target.version.builds",{templateUrl:"partials/timeline.html",controller:"TimelineCtrl",resolve:{versionBuilds:["$stateParams","QueryService","Data","target","version","testsFilter","buildsFilter",function(a,b,c,d,e,f,g){var h=c.getBuildFilter(),i=c.getBuildsFilter();return b.getBuilds(d,e,h,i).then(function(a){return c.setVersionBuilds(a),c.getVersionBuilds()})}]}}).state("target.version.builds.build",{url:"/:build",template:"<ui-view />",controller:["$state","build","Data",function(a,b,c){c.setBuild(b),a.go("target.version.builds.build.jobs")}],resolve:{build:["$stateParams","$state","versionBuilds","Data",function(a,b,c,d){if("latest"==(a.build||"latest")&&c.length>0){var e=c[c.length-1].build;a.build=e.split("-")[1]}else c.length<=0&&(d.setBuildsFilter(5),d.setBuildFilter(0),b.go("target.version.builds",{target:a.target,version:a.version}));return a.build}]}}).state("target.version.builds.build.jobs",{templateUrl:"partials/jobs.html",controller:"JobsCtrl",resolve:{buildJobs:["$stateParams","QueryService","Data","target",function(a,b,c,d){var e=c.getBuild();return b.getJobs(e,d)}]}}).state("compareBuilds",{templateUrl:"partials/comparer.html",controller:"comparer",resolve:{target:["$stateParams","Data",function(a,b){return a.target=a.target||b.getCurrentTarget(),a.target}],versions:["$stateParams","Data","QueryService","target",function(a,b,c,d){var e=b.getTargetVersions(d);return e||(e=c.getVersions(d),b.setTargetVersions(e)),e}],version1:["$stateParams","versions",function(a,b){return a.version1=a.version1||b[b.length-1],a.version1}],version2:["$stateParams","versions",function(a,b){return a.version2=a.version2||b[b.length-1],a.version2}],builds1:["$stateParams","QueryService","target","version1",function(a,b,c,d){return b.getBuilds(c,d,2e3,5).then(function(a){return a})}],builds2:["$stateParams","QueryService","target","version2","builds1",function(a,b,c,d,e){return a.version1==d?e:b.getBuilds(c,d,2e3,5).then(function(a){return a})}],build1:["$stateParams","builds1",function(a,b){return a.build1=a.build1||b[b.length-2].build,a.build1}],build2:["$stateParams","builds2",function(a,b){return a.build2=a.build2||b[b.length-1].build,a.build2}],build1details:["$stateParams","Data","QueryService","build1",function(a,b,c,d){return c.getBuildSummary(d)}],build2details:["$stateParams","Data","QueryService","build2",function(a,b,c,d){return c.getBuildSummary(d)}]}})}]),angular.module("app.compare",["googlechart","svc.query"]).controller("comparer",["$scope","$state","Data","QueryService","target","versions","version1","version2","builds1","builds2","build1","build2","build1details","build2details",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){function o(b,c,d,e,f){return{type:b,data:{cols:[{id:c,label:c,type:"string",p:{}},{id:"build1",label:a.compareVersion1+"-"+a.compareBuildId1,type:"number",p:{html:!0}},{id:"build2",label:a.compareVersion2+"-"+a.compareBuildId2,type:"number",p:{html:!0}}],rows:[]},options:{title:f,isStacked:"false",displayExactValues:!0,vAxis:{title:e,gridlines:{count:5}},hAxis:{title:d,slantedText:!0,slantedTextAngle:90,showTextEvery:1,textStyle:{fontSize:10}},bar:{groupWidth:"20%"},legend:{position:"top"},allowHtml:!0,tooltip:{isHtml:!0},width:"100%",height:500},formatters:{color:[{columnNum:1,formats:[{from:0,to:95,color:"red"},{from:95,to:101,color:"green"}]},{columnNum:2,formats:[{from:0,to:95,color:"red"},{from:95,to:101,color:"green"}]}]}}}function p(a,b,c,d,e,f,g){var h=o(c,d,e,f,g),i=_.mapValues(_.omitBy(a,_.isNumber),s),j=_.mapValues(_.omitBy(b,_.isNumber),s);return h.data.rows=_.map(i,function(a,b){var c=_.get(j,b,{runPerc:0,totalCount:0,pendingTests:0});return t(a,c,b)}),h}function q(a,b,c,d,e,f,g){var h=o(c,d,e,f,g),i=_.mapValues(_.omitBy(a,_.isNumber),u),j=_.mapValues(_.omitBy(b,_.isNumber),u);return h.data.rows=_.map(i,function(a,b){var c=_.get(j,b,{passPerc:0,passCount:0,failCount:0});return v(a,c,b)}),h}function r(b,c){return _.mapValues(b,function(b,d){var e=_.get(c,d);return{runPercChart:p(b,e,a.graphType,"Component for "+d,"Run %","Component","Runs % per component for "+d),passPercChart:q(b,e,a.graphType,"Component for "+d,"Run %","Component","Pass % per component for "+d)}})}d.getVersions(e).then(function(a){return a});e||(e="server"),0==f.length&&(f=d.getVersions(e).then(function(a){return a})),g||(g=f[f.length-1]),h||(h=f[f.length-1]),0==i.length&&(i=d.getBuilds(e,g,2e3,5).then(function(a){return a})),0==j.length&&(j=d.getBuilds(e,h,2e3,5).then(function(a){return a})),k||(k=i[i.length-1].build),l||(l=j[j.length-1].build),m||(m=d.getBuildSummary(k).then(function(a){return a})),n||(n=d.getBuildSummary(l).then(function(a){return a})),a.changeCompareTarget=function(b){a.compareTarget=b},a.version1Change=function(b){a.compareVersion1=b},a.version2Change=function(b){a.compareVersion2=b},a.build1Change=function(b){a.compareBuildId1=b},a.build2Change=function(b){a.compareBuildId2=b},a.changeGraphType=function(b){a.graphType=b},a.changeOs=function(b){a.compareOS=b},a.$watch(function(){return a.compareTarget},function(b,c){if(b!==c){d.getVersions(b).then(function(b){return a.compareVersion1=b[b.length-1],a.compareVersion2=b[b.length-1],a.versions=b,b})}}),a.$watch(function(){return a.compareVersion1},function(b,c){if(b!==c){d.getBuilds(a.compareTarget,b,2e3,5).then(function(b){var c=_.map(_.map(b,"build"),function(a){return a.split(["-"])[1]});return a.compareBuildId1=c[c.length-1],a.compareBuilds1=c,b})}}),a.$watch(function(){return a.compareVersion2},function(b,c){if(b!==c){d.getBuilds(a.compareTarget,b,2e3,5).then(function(b){var c=_.map(_.map(b,"build"),function(a){return a.split(["-"])[1]});return a.compareBuildId2=c[c.length-1],a.compareBuilds2=c,b})}}),a.$watch(function(){return a.compareBuildId1},function(b,c){if(b!==c){d.getBuildSummary(a.compareVersion1+"-"+b).then(function(b){return a.osRunPercChart=p(b.os,n.os,a.graphType,"OS","Run %","OS","Total run % per OS"),a.osPassPercChart=q(b.os,n.os,a.graphType,"OS","Pass %","OS","Pass % per OS"),a.componentsCharts=r(b.os,n.os),a.runPercChart=a.componentsCharts[a.compareOS].runPercChart,a.passPercChart=a.componentsCharts[a.compareOS].passPercChart,m=b,b})}}),a.$watch(function(){return a.compareBuildId2},function(b,c){if(b!==c){d.getBuildSummary(a.compareVersion2+"-"+b).then(function(b){return a.osRunPercChart=p(m.os,b.os,a.graphType,"OS","Run %","OS","Total run % per OS"),a.osPassPercChart=q(m.os,b.os,a.graphType,"OS","Pass %","OS","Pass % per OS"),a.componentsCharts=r(m.os,b.os),a.runPercChart=a.componentsCharts[a.compareOS].runPercChart,a.passPercChart=a.componentsCharts[a.compareOS].passPercChart,n=b,b})}}),a.$watch(function(){return a.graphType},function(b,c){b!==c&&(a.osRunPercChart.type=b,a.osPassPercChart.type=b,a.runPercChart.type=b,a.passPercChart.type=b,_.forEach(a.componentsCharts,function(a,c){a.runPercChart.type=b,a.passPercChart.type=b}))}),a.$watch(function(){return a.compareOS},function(b,c){b!==c&&(a.runPercChart=a.componentsCharts[b].runPercChart,a.passPercChart=a.componentsCharts[b].passPercChart)});var s=function(a){if(_.isObject(a)){return{runPerc:a.totalCount/(a.totalCount+a.pending)*100,totalCount:a.totalCount,pendingTests:a.pending}}},t=function(a,b,c){if(_.isObject(a)&&_.isObject(b))return{c:[{v:c},{v:_.isNaN(a.runPerc)?0:a.runPerc,f:"Run %: "+(_.isNaN(a.runPerc)?0:a.runPerc)+"<br/>Total Test run: "+a.totalCount+"<br/>Pending tests: "+a.pendingTests},{v:_.isNaN(b.runPerc)?0:b.runPerc,f:"Run %: "+(_.isNaN(b.runPerc)?0:b.runPerc)+"<br/>Total Test run: "+b.totalCount+"<br/>Pending tests: "+b.pendingTests}]}},u=function(a){if(_.isObject(a)){return{passPerc:(a.totalCount-a.failCount)/a.totalCount*100,passCount:a.totalCount-a.failCount,failCount:a.failCount}}},v=function(a,b,c){if(_.isObject(a)&&_.isObject(b))return{c:[{v:c},{v:_.isNaN(a.passPerc)?0:a.passPerc,f:"Pass%: "+(_.isNaN(a.passPerc)?0:a.passPerc)+"<br/>Passed tests: "+a.passCount+"<br/>Failed tests: "+a.failCount},{v:_.isNaN(b.passPerc)?0:b.passPerc,f:"Pass%: "+(_.isNaN(b.passPerc)?0:b.passPerc)+"<br/>Passed tests: "+b.passCount+"<br/>Failed tests: "+b.failCount}]}};a.compareTargets=["server","mobile"],a.compareTarget=e,a.versions=f;var g=k.split(["-"])[0];a.compareVersion1=a.versions[_.indexOf(a.versions,g)];var h=l.split(["-"])[0];a.compareVersion2=a.versions[_.indexOf(a.versions,h)],a.compareBuildId1=k.split(["-"])[1],a.compareBuildId2=l.split(["-"])[1];var w=_.map(_.map(i,"build"),function(a){return a.split(["-"])[1]}),x=_.map(_.map(j,"build"),function(a){return a.split(["-"])[1]});a.compareBuilds1=w,a.compareBuilds2=x,a.graphTypes=["BarChart","ColumnChart","LineChart","Table"],a.graphType="Table",a.osRunPercChart=p(m.os,n.os,a.graphType,"OS","Run %","OS","Total run % per OS"),a.osPassPercChart=q(m.os,n.os,a.graphType,"OS","Pass %","OS","Pass % per OS"),a.componentsCharts=r(m.os,n.os),a.compareOSs=_.keys(a.componentsCharts),a.compareOS="CENTOS",a.runPercChart=a.componentsCharts[a.compareOS].runPercChart,a.passPercChart=a.componentsCharts[a.compareOS].passPercChart}]),function(){"use strict";angular.module("svc.timeline",[]).directive("viewTimeline",["Data","Timeline",function(a,b){return{restrict:"E",scope:{onChange:"=",builds:"="},link:function(c,d,e){var f=c.builds,g="#"+d.attr("id");b.init(f,g,c.onChange),c.$watch(function(){return a.getBuildFilter()},function(c,d){void 0!=d&&c!=d&&(f=a.getVersionBuilds(),b.update(f,g))}),c.$watch(function(){return a.getBuildFilter()},function(c,d){c!=d&&(f=a.getVersionBuilds(),b.update(f,g))}),c.$watch(function(){return a.getBuildsFilter()},function(d,e){d!=e&&(c.spin=!0,f=a.getVersionBuilds(),b.update(f,g),c.spin=!1)})}}}]).service("Timeline",["Data","$timeout",function(a,b){function c(a){return d3.max(a,function(a){return d3.max(a,function(a){return a.y0+a.y})})}function d(a){return d3.scale.ordinal().domain(a).rangeRoundBands([0,C],.08)}function e(a){return d3.scale.linear().domain([0,a]).range([D,0])}function f(a){var b=d3.svg.axis().scale(a).tickSize(0).tickPadding(6).orient("bottom"),c=a.domain(),d=Math.floor(c.length/20);if(d>1){var e=c.filter(function(a,b){return b%d==0});b.tickValues(e)}return b}function g(a,b){var c=d3.svg.axis().scale(a).tickSize(0).tickPadding(6).orient("left").tickSize(-C,0,0),d=d3.range(b);if(b>50){for(;d.length>=10;)d=d.filter(function(a,b){return b%10==0});d.length>5&&(d=d.filter(function(a,b){return b%2==0}))}else d=[b];return c.tickValues(d),c}function h(){return C+B.left+B.right}function i(){return D+B.top+B.bottom}function j(a){return d3.select(a).append("svg").attr("width",h()).attr("height",i()).append("g").attr("transform","translate("+B.left+","+B.top+")")}function k(a,b){var c=a.selectAll(".layer").data(b);return c.enter().append("g").attr("class","layer"),c}function l(a,b){var c=b.selectAll("rect").data(function(a){return a});return c.enter().append("rect").attr("x",function(b){return a(b.x)}).attr("y",D).attr("width",a.rangeBand()).attr("height",0).style("fill",function(a,b,c){return a.x==u?F[c]:E[c]}),c.exit().transition().delay(100).attr("y",function(a){return A(a.y0)}).attr("height",0),c}function m(a,b){b.transition().delay(function(a,b){return 10*b}).attr("y",function(b){return a(b.y0+b.y)}).attr("height",function(b){return a(b.y0)-a(b.y0+b.y)})}function n(a,b,c,d,e){return d3.tip().attr("class","d3-tip "+e).offset([b,c]).direction(a).html(d)}function o(a,b,c){var d=function(a,b){return a},e=n("e",0,10,d,"d3-tip-pass"),f=n("e",0,10,d,"d3-tip-fail"),g=n("n",-10,0,d);a.call(e),a.call(f),a.call(g),c.on("mouseover",function(a,d){e.show(b[0][d].y,d,c[0][d]),f.show(b[1][d].y,d,c[1][d]),g.show(a.x,c[1][d])}),c.on("mouseout",function(a,b){e.hide(),f.hide(),g.hide()})}function p(a,b){a.on("click",function(c,d){a.style("fill",function(a,b,c){return b==d?F[c]:E[c]});var e=c.x;b(e)})}function q(a,b){a.append("g").attr("class","x axis").attr("transform","translate(0,"+D+")").call(b).selectAll("text").style("text-anchor","end").attr("dx","-.8em").attr("dy",".15em").attr("transform","rotate(-65)")}function r(a,b){a.append("g").attr("class","y axis").attr("transform","translate(0,0)").call(b)}function s(b){u=a.getBuild(),-1==b.indexOf(u)&&(u=b[b.length-1])}function t(a){var b=d3.layout.stack(),h=_.map(a,"build"),i=["Passed","Failed"].map(function(b){return a.map(function(a,c){return{x:h[c],y:a[b]}})}),j=b(i),n=c(j),t=d(h),u=f(t);A=e(n);var w=g(A,n);s(h),y=k(x,j),z=l(t,y),m(A,z),o(x,j,z),p(z,v),q(x,u),r(x,w)}var u,v,w,x,y,z,A,B={top:40,right:10,bottom:100,left:70},C=800-B.left-B.right,D=300-B.top-B.bottom,E=["rgba(59, 201, 59, 0.5)","rgba(222, 0, 0, 0.5)"],F=["rgba(59, 201, 59, 1)","rgba(222, 0, 0, 1)"];return{init:function(a,b,c){x=j(b),w=b,v=c,t(a)},update:function(a){z.transition().delay(100).attr("y",function(a){return A(a.y0)}).attr("height",0),x.selectAll(".tick text").transition().delay(10).style("fill","white"),b(function(){x.select(".x").remove(),x.select(".y").remove(),y.remove(),t(a)},250)}}}])}(),angular.module("svc.data",[]).value("DEFAULT_FILTER_BY",2e3).value("DEFAULT_BUILDS_FILTER_BY",10).service("Data",["$location","DEFAULT_FILTER_BY","DEFAULT_BUILDS_FILTER_BY",function(a,b,c){function d(b,c,d){var e=a.search()[b];if(d){if(e){var f=new RegExp(",?"+c),e=e.replace(f,"").replace(/^,/,"");""==e&&(e=null),a.search(b,e)}}else e&&0!=e.length?-1==e.indexOf(c)&&(e+=","+c):e=c,_.some(_.map(_sideBarItems[b],"disabled"))||(e=null),a.search(b,e)}function e(a,b,c){_sideBarItems[a]=_sideBarItems[a].map(function(a){return a.key==b&&(a.disabled=c),a}),d(a,b,c)}function f(a,b){var c="platforms"==b?"os":"component";c="serverVersions"==b?"server_version":c,_buildJobsActive=_.reject(_buildJobsActive,function(b){return b[c]==a}),e(b,a,!0)}function g(a,b){var c="platforms"==b?"os":"component";c="serverVersions"==b?"server_version":c;var d=_.filter(_buildJobs,function(b){if(b[c]==a){var d="os"==c?["features","component","serverVersions"]:["platforms","os","server_version"];if(!_.find(_sideBarItems[d[0]],{key:b[d[1]]}).disabled)return!0}});_buildJobsActive=_buildJobsActive.concat(d),e(b,a,!1)}function h(){var a=_builds.filter(function(a){return a.Passed+a.Failed>_filterBy});return 0==_filterBy&&(a=_builds.filter(function(a){return a.Passed+a.Failed<b})),0==a.length&&0!=_filterBy&&(a=_builds,_filterBy=0),a}function i(){var a=_build;return"latest"!=a&&""!=a||_builds.length>0&&(a=_builds[_builds.length-1]),a&&-1==a.indexOf("-")&&(a=_version+"-"+a),a}return _versions=[],_target="server",_version=null,_versions=[],_build=null,_builds=[],_targetVersions={},_buildJobs=[],_buildJobsActive=[],_sideBarItems=[],_filterBy=b,_buildsFilterBy=c,_initUrlParams=null,_buildInfo={},{setTarget:function(a){_target=a},setTargetVersions:function(a){_target&&(_targetVersions[_target]=a),_versions=a},setSelectedVersion:function(a){_version=a},setBuild:function(a){-1==a.indexOf("-")&&_version&&(a=_version+"-"+a),_build=a},setBuildInfo:function(a){_buildInfo=a},getBuildInfo:function(){return _buildInfo},setVersionBuilds:function(a){a.sort(function(a,b){return a.build<b.build?-1:a.build>b.build?1:0}),_builds=a},setBuildJobs:function(a){_buildJobs=a,_buildJobsActive=a},getBuildJobs:function(){return _buildJobs},getActiveJobs:function(){return _buildJobsActive},getCurrentTarget:function(){return _target},getTargetVersions:function(a){var b=_versions;return a&&(b=_targetVersions[a]),b},getSelectedVersion:function(){return _version},getBuild:function(){return i()},getVersionBuilds:h,toggleItem:function(a,b,c){if(c){if(_.some(_.map(_sideBarItems[b],"disabled")))f(a,b);else{_.map(_sideBarItems[b],"key").forEach(function(c){c!=a&&f(c,b)}),e(b,a,!1)}}else g(a,b)},setSideBarItems:function(a){_sideBarItems=a,_sideBarItems.buildVersion=i(),_initUrlParams&&_initUrlParams.target==_target&&(_.mapKeys(a,function(a,b){b in _initUrlParams&&a.forEach(function(a){f(a.key,b)})}),_.mapKeys(_initUrlParams,function(a,b){if(-1!=["platforms","features","serverVersions"].indexOf(b)){a.split(",").forEach(function(a){g(a,b)})}})),_initUrlParams=null},getSideBarItems:function(){return _sideBarItems},getItemStats:function(a,b){var c="platforms"==b?"os":"component";c="serverVersions"==b?"server_version":c;var d=_buildJobsActive;"build"!=b&&(d=_.filter(_buildJobsActive,function(b){return b[c]==a})),d=_.reject(d,"olderBuild",!0),d=_.reject(d,"deleted",!0),d=_.uniqBy(d,"name");var e=_.sum(_.map(_.uniq(d),"totalCount")),f=_.sum(_.map(_.uniq(d),"failCount")),g=_.sum(_.map(_.uniq(d),"pending"));e||(e=0),f||(f=0),g||(g=0);var h={passed:e-f,failed:f,pending:g},i=getPercOfVal(h,h.passed);return{absStats:h,percStats:{run:getItemPercStr(h),passed:wrapPercStr(i),failed:getPercOfValStr(h,h.failed),pending:getPercOfValStr(h,h.pending),passedRaw:i}}},toggleAllSidebarItems:function(a,b){_sideBarItems[a].forEach(function(c){b&&!c.disabled?f(c.key,a):c.disabled&&g(c.key,a)})},getBuildFilter:function(){return _filterBy},setBuildFilter:function(a){void 0===a&&(a=b),_filterBy=a},getBuildsFilter:function(){return _buildsFilterBy},setBuildsFilter:function(a){void 0===a&&(a=c),_buildsFilterBy=a},getLatestVersionBuild:function(){var a=h();return a.length>0?a[a.length-1].build:_build},setUrlParams:function(a){null===_initUrlParams&&(a.target=_target,_initUrlParams=a)}}}]),angular.module("app.infobar",[]).directive("viewInfobar",["Data","QueryService",function(a,b){return{restrict:"E",scope:{},templateUrl:"partials/infobar.html",link:function(c,d,e){c.expandedIndexes=[],c.expandChange=function(a){if(c.isExpanded(a)){var b=_.indexOf(c.expandedIndexes,a);c.expandedIndexes.splice(b,1)}else c.expandedIndexes.push(a)},c.isExpanded=function(a){return c.expandedIndexes.indexOf(a)>-1},c.formatChangeMsg=function(a){var b=a.split("\n"),c=b[0];if(b.length>1){c='<a href="'+b[2].replace("Reviewed-on: ","")+'">'+c+"</a>"}return c},c.$watch(function(){return a.getBuild()},function(d,e){c.hasChangeSet=!1;var f=a.getCurrentTarget();b.getBuildInfo(d,f).then(function(a){var b={};b=a.value,a.err?console.log(d,a.err):(c.info=b,c.hasChangeSet=!0)})})}}}]),angular.module("app.main",[]).controller("NavCtrl",["$scope","$state","$stateParams","Data","target","targetVersions","version",function(a,b,c,d,e,f,g){f=_.compact(f),d.setTarget(e),d.setSelectedVersion(g),d.setTargetVersions(f),b.go("target.version.builds.build"),a.changeTarget=function(a){"cblite"==a||"sync_gateway"==a?d.setBuildFilter(0):d.setBuildFilter(2e3),b.go("target.version",{target:a,version:"latest"})},a.changeVersion=function(a){a!=g&&(d.setBuildsFilter(10),b.go("target.version",{version:a}))}}]).controller("TimelineCtrl",["$scope","$state","versionBuilds","Data",function(a,b,c,d){a.versionBuilds=c,a.onBuildChange=function(c){a.build=c,d.setBuild(c),-1!=c.indexOf("-")&&(c=c.split("-")[1]),b.go("target.version.builds.build",{build:c})},a.$watch(function(){return d.getBuild()},function(b){a.build=b}),b.go("target.version.builds.build",{build:"latest"})}]).controller("JobsCtrl",["$scope","$state","$stateParams","Data","buildJobs",function(a,b,c,d,e){function f(b){var c={Analyzed:0},d=0;_.forEach(Object.keys(i),function(a){c[a]=0});var e={},f=["MB","CBQE","CBIT","CBD"];_.forEach(f,function(a){e[a]=0}),_.forEach(b,function(a){if(""!==a.claim&&!a.olderBuild){var b=!1;_.forEach(Object.keys(c),function(d){if(a.claim.startsWith(d))return c[d]+=1,b=!0,!1}),b||_.forEach(f,function(d){if(a.claim.startsWith(d+"-"))return c[a.claim]?c[a.claim]+=1:c[a.claim]=1,e[d]+=1,b=!0,!1})}});var g=[];_.forEach(Object.entries(c),function(a){a[1]>0&&(d+=a[1],g.push({claim:a[0],count:a[1]}))}),e.IT=e.CBD+e.CBIT,delete e.CBD,delete e.CBIT,a.jiraCounts=Object.entries(e).map(function(a){var b,c=a[0];return"MB"===c?b="Product bugs (MB)":"CBQE"===c?b="Test bugs (CBQE)":"IT"===c&&(b="IT bugs (CBIT/CBD)"),{name:b,count:a[1],percent:0==d?0:(a[1]/d*100).toFixed(0)}}),a.claimSummary=g,a.totalClaims=d,a.needToAnalyseCount=b.filter(function(a){return!a.olderBuild&&!a.deleted&&(!["PENDING","SUCCESS"].includes(a.result)||"PENDING"===a.result&&""!==a.claim)}).length,a.analysedPercent=0==a.needToAnalyseCount?0:(a.totalClaims/a.needToAnalyseCount*100).toFixed(0)}function g(b){b=_.reject(b,"olderBuild",!0),b=_.reject(b,"deleted",!0);var c=_.uniq(_.reject(b,["result","PENDING"])),d=_.uniq(_.filter(b,["result","SUCCESS"])),e=_.uniq(_.filter(b,["result","ABORTED"])),g=_.uniq(_.filter(b,["result","UNSTABLE"])),h=_.uniq(_.filter(b,["result","FAILURE"])),i=_.uniq(_.filter(b,["result","PENDING"]));a.panelTabs=[{title:"Jobs Completed",jobs:c,active:!0},{title:"Jobs Success",jobs:d},{title:"Jobs Aborted",jobs:e},{title:"Jobs Unstable",jobs:g},{title:"Jobs Failed",jobs:h},{title:"Jobs Pending",jobs:i}],f(b)}function h(){d.getBuild();return e}var i={"git error":["hudson.plugins.git.GitException","python3: can't open file 'testrunner.py': [Errno 2] No such file or directory"],"SSH error":["paramiko.ssh_exception.SSHException","Exception SSH session not active occurred on"],"IPv6 test on IPv4 host":["Cannot enable IPv6 on an IPv4 machine"],"Python SDK error (CBQE-6230)":["ImportError: cannot import name 'N1QLQuery' from 'couchbase.n1ql'"],"Syntax error":["KeyError:","TypeError:"],"json.decoder.JSONDecodeError:":["json.decoder.JSONDecodeError:"],"ServerUnavailableException: unable to reach the host":["ServerUnavailableException: unable to reach the host"],"Node already added to cluster":["ServerAlreadyJoinedException:"],"CBQ Error":["membase.api.exception.CBQError:","CBQError: CBQError:"],"RBAC error":['Exception: {"errors":{"roles":"Cannot assign roles to user because the following roles are unknown, malformed or role parameters are undefined: [security_admin]"}}'],"Rebalance error":["membase.api.exception.RebalanceFailedException"],"Build download failed":["Unable to copy build to","Unable to download build in"],"install not started":["INSTALL NOT STARTED ON"],"install failed":["INSTALL FAILED ON"],"No test report xml":["No test report files were found. Configuration error?"]};a.jiraCounts=[],a.showAnalysis=!0,a.changeShowAnalysis=function(){a.showAnalysis=!a.showAnalysis},a.predicate="result",a.reverse=!0,a.activePanel=0,a.onselect=function(b,c,e){var f=d.getActiveJobs();f=_.reject(f,"deleted",!0);var g={name:b,os:c,component:e},h=f;_.forEach(g,function(a,b){h=_.filter(h,[b,a])}),a.len=h.length,a.selectedjobdetails=h,a.selectedjobname=b,a.selectedbuild=h[0].build};var j=h();g(j),d.setBuildJobs(j);var k=_.uniq(_.map(j,"os")).map(function(a){return{key:a,disabled:!1}}),l=_.uniq(_.map(j,"component")).map(function(a){return{key:a,disabled:!1}}),m=_.uniq(_.map(e,"server_version")).map(function(a){return a?{key:a,disabled:!1}:null});d.setSideBarItems({platforms:k,features:l,serverVersions:m}),a.changePanelJobs=function(b){a.activePanel=b},a.msToTime=msToTime,a.$watch(function(){return d.getActiveJobs()},function(a){a&&g(a)})}]).controller("JobDetailsCtrl",["$scope","$state","$stateParams","Data","target",function(a,b,c,d,e){a.msToTime=msToTime;var f=c.jobName;a.$watch(function(){return d.getActiveJobs()},function(b){b=_.reject(b,"deleted",!0);var c=_.filter(b,["name",f]);a.jobDetails=c,a.jobname=f,a.build=c[0].build})}]).directive("claimCell",["Data","QueryService",function(a,b){return{restrict:"E",scope:{job:"="},templateUrl:"partials/claimcell.html",link:function(c,d,e){c.job.customClaim&&(c.job.claim=c.job.customClaim);var f="";$(d).mouseover(function(){f=""!=c.job.claim?c.job.claim:"No Claim for this build",$('[data-toggle="popover"]').popover({placement:"top",trigger:"hover",content:c.job.claim})}),c.editClaim=!1,c.saveClaim=function(){var d=a.getCurrentTarget(),e=c.job.name,f=c.job.build_id,g=c.job.claim,h=c.job.os,i=c.job.component,j=c.job.build;b.claimJob(d,e,f,g,h,i,j).catch(function(a){c.job.claim="error saving claim: "+a.err}),c.updateClaim(),c.editClaim=!1},c.showFullClaim=!1,c.changeShowFullClaim=function(){c.showFullClaim=!c.showFullClaim,c.updateClaim()},c.updateClaim=function(){c.claim=c.showFullClaim||c.job.claim.length<100?c.job.claim:c.job.claim.split("<br><br>")[0].slice(0,100)+"..."},c.updateClaim()}}}]),angular.module("svc.query",[]).service("QueryService",["$http","Data",function(a,b){return{getVersions:function(b){var c=["versions",b].join("/");return a({url:c,cache:!0}).then(function(a){return a.data})},getBuilds:function(b,c,d,e){var f=["builds",b,c,d,e].join("/");return a({url:f,cache:!0}).then(function(a){return a.data})},getJobs:function(b,c){var d=["jobs",b,c].join("/");return a({url:d,cache:!0}).then(function(a){return a.data})},getBuildInfo:function(b,c){var d=["info",b,c].join("/");return a({url:d,cache:!0}).then(function(a){return a.data})},claimJob:function(b,c,d,e,f,g,h){var i=["claim",b,c,d].join("/");return a.post(i,{claim:e,os:f,comp:g,build:h})},getBuildSummary:function(b){var c=["getBuildSummary",b].join("/");return a({url:c,cache:!0}).then(function(a){return a.data})}}}]),angular.module("app.sidebar",[]).directive("viewSidebar",["Data",function(a){return{restrict:"E",scope:{},templateUrl:"partials/sidebar.html",link:function(b,c,d){b.showPerc=!1,b.disablePlatforms=!1,b.disableFeatures=!1,b.disabledServerVersions=!1,b.buildVersion=a.getBuild(),b.targetBy=a.getCurrentTarget(),b.toggleAll=function(c){var d;"platforms"==c?(d=!b.disablePlatforms,b.disablePlatforms=d):"features"==c?(d=!b.disableFeatures,b.disableFeatures=d):"serverVersions"==c&&(d=!b.disabledServerVersions,b.disabledServerVersions=d),a.toggleAllSidebarItems(c,d)},b.$watch(function(){return a.getSideBarItems()},function(a,c){if(a){b.buildVersion=a.buildVersion,b.sidebarItems={platforms:_.map(a.platforms,"key"),features:_.map(a.features,"key"),serverVersions:_.map(a.serverVersions,"key")};var d=!_.some(_.map(a.platforms,"disabled")),e=!_.some(_.map(a.features,"disabled")),f=!_.some(_.map(a.serverVersions,"disabled"));b.disablePlatforms=!d,b.disableFeatures=!e,b.disabledServerVersions=!f}},!0)}}}]).directive("sidebarItem",["Data",function(a){return{restrict:"E",scope:{type:"@",key:"@",asNum:"&showPerc"},templateUrl:"partials/sidebar_item.html",link:function(b,c,d){b.disabled=!1,b.stats=a.getItemStats(b.key,b.type),b.getRunPercent=function(){if(!b.disabled)return b.stats.percStats.run},b.getDashboardUrl=function(){var a={"2I_MOI":"ovawbLBGk","2I_REBALANCE":"Yr2QbLBMz",ANALYTICS:"Qb8QbYfGz",AUTO_FAILOVER:"mO6lbYBGz",BACKUP_RECOVERY:"Dv_QxLfGz",BUILD_SANITY:"IPm-bSLMk",CE_ONLY:"80ZuxLBGk",CLI:"U6gubLfMz",COLLECTIONS:"BGtwbLfMk",COMPRESSION:"RQX_bYfMz",DURABILITY:"qH5QbYBMz",EP:"aTj_xYBGk",EPHEMERAL:"feYwbLBMk",EVENTING:"k2QQbLfMk",FTS:"pBAwxLfGk",GEO:"Dn4ubYfGz",GOXDCR:"h1JQbLfGz",IMPORT_EXPORT:"kf9lbLBGk",IPV6:"K_rQxLBGz",LOG_REDACTION:"Cv7XxYfMz",MAGMA:"09PQxLBMz",MOBILE:"QMRuxYBGz",MOBILE_CONVERGENCE:"LyywbLfGk",NSERV:"iUowxYfGz",OS_CERTIFY:"Od2-6tfMk",PLASMA:"qiLwbLfGk",QUERY:"C2dQxYBMk",RBAC:"KGXQbYBMz",RQG:"tnfwbYBMk",RZA:"iRIubYBMz",SANITY:"tGRa6tBMk",SDK:"Bdq_bLBGz",SECURITY:"SpxQxYfGk",SUBDOC:"feuQbYBGz",TUNABLE:"_LmXxYBMk",UNIT:"fKMuxYBMk",UPGRADE:"ftKwxYfGz",VIEW:"-_zubYBMk"},c=a[b.key];return c?"http://qe.service.couchbase.com:3000/d/"+c:null},b.getNumOrPerc=function(a){var c=b.stats;return b.asNum()?c.absStats[a]:c.percStats[a]},b.toggleItem=function(){"build"!=b.type&&a.toggleItem(b.key,b.type,!b.disabled)},b.bgColor=function(){var a="greyed",c=b.stats;return b.disabled?(b.glyphiconClass="glyphicon-unchecked",a):(b.glyphiconClass="glyphicon-check",passPerc=c.percStats.passedRaw,100==passPerc?a="bg-success":passPerc>=70?a="bg-warning":passPerc>=0&&(a=c.absStats.failed>0?"bg-danger":"bg-muted"),a)},b.$watch(function(){return a.getSideBarItems()},function(c){var d=_.find(c[b.type],{key:b.key});d&&(b.disabled=d.disabled),b.stats=a.getItemStats(b.key,b.type)},!0)}}}]),angular.module("app.target",[]).directive("targetSelector",["ViewTargets","Data",function(a,b){return{restrict:"E",scope:{changeTarget:"="},templateUrl:"partials/targets.html",link:function(c,d,e){c.$watch(function(){return b.getCurrentTarget()},function(b){b&&(c.viewTargets=a.allTargets(),c.targetBy=a.getTarget(b))})}}}]).directive("filterSelector",["Data","QueryService",function(a,b){return{restrict:"E",scope:{changeFilter:"="},templateUrl:"partials/filters.html",link:function(c,d,e){c.activeFilter=a.getBuildFilter(),c.passFilters=[0,2e3,5e3],c.changeFilter=function(d){var e=a.getCurrentTarget(),f=a.getSelectedVersion(),g=a.getBuildsFilter(),h=d;b.getBuilds(e,f,h,g).then(function(b){return a.setVersionBuilds(b),a.setBuildFilter(c.activeFilter),a.getVersionBuilds()}),c.activeFilter=d}}}}]).directive("buildsFilterSelector",["Data","QueryService",function(a,b){return{restrict:"E",scope:{changeBuildsFilter:"=?"},templateUrl:"partials/buildsfilters.html",link:function(c,d,e){c.activeBuildFilter=a.getBuildsFilter(),c.buildsFilters=[5,10,25,100],c.changeBuildsFilter=function(d){var e=a.getCurrentTarget(),f=a.getSelectedVersion(),g=a.getBuildFilter(),h=d;(function(){b.getBuilds(e,f,g,h).then(function(b){return a.setVersionBuilds(b),a.setBuildsFilter(c.activeBuildFilter),a.getVersionBuilds()})})(),c.activeBuildFilter=d}}}}]).directive("versionSelector",["$stateParams","ViewTargets","QueryService","Data",function(a,b,c,d){return{restrict:"E",templateUrl:"partials/versions.html",scope:{changeVersion:"="},link:function(a,b,c){function e(){var b=a.versionGroups.length-1;a.hasNext=0!=a.groupIndex,a.hasPrevious=a.groupIndex!=b}a.hasNext=!0,a.hasPrevious=!0;var f=5;a.showPrevious=function(){a.hasPrevious&&(a.groupIndex++,a.targetVersions=a.versionGroups[a.groupIndex],e())},a.showNext=function(){a.hasNext&&(a.groupIndex--,a.targetVersions=a.versionGroups[a.groupIndex],e())},a.$watch(function(){return d.getSelectedVersion()},function(b){if(b){a.version=b;var c=_.clone(d.getTargetVersions());c.reverse();var g=_.indexOf(c,b);a.versionGroups=_.map(_.chunk(c,f),function(a){return a.reverse(),a}),a.groupIndex=Math.floor(g/f),a.targetVersions=a.versionGroups[a.groupIndex],e()}})}}}]).factory("ViewTargets",["COUCHBASE_TARGET","SDK_TARGET","SG_TARGET","CBLITE_TARGET","CBO_TARGET",function(a,b,c,d,e){var f=[a,b,c,d,e],g={};return f=f.map(function(a,b){return a.i=b,g[a.bucket]=a,a}),{allTargets:function(){return f},getTarget:function(a){return g[a]}}}]).value("COUCHBASE_TARGET",{title:"Couchbase Server",bucket:"server",key:"abspassed",value:100,options:[0,50,100,500]}).value("SDK_TARGET",{title:"SDK",bucket:"sdk",key:"abspassed",value:100,options:[0,50,100,500]}).value("SG_TARGET",{title:"Sync Gateway",bucket:"sync_gateway",key:"abspassed",value:0,options:[0,50,100,500]}).value("CBLITE_TARGET",{title:"Couchbase Lite",bucket:"cblite",key:"abspassed",value:0,options:[0,50,100,500]}).value("CBO_TARGET",{title:"Couchbase Operator",bucket:"operator",key:"abspassed",value:0,options:[0,50,100,500]});